var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;import{defineComponent as a,ref as c,computed as l,onMounted as u,onUnmounted as g,createVNode as m}from"vue";const d="Please consider reporting this error at https://github.com/laymonage/giscus/issues/new.";function p(e){return`[giscus] An error occurred. Error message: "${e}".`}function f(e){const t=document.querySelector(`meta[property='og:${e}'],meta[name='${e}']`);return t?t.content:""}function h(){const e=document.getElementById("giscus-css")||document.createElement("style");e.id="giscus-css",e.textContent="\n    .giscus, .giscus-frame {\n      width: 100%;\n    }\n    .giscus-frame {\n      border: none;\n      color-scheme: normal;\n    }\n  ",document.head.prepend(e)}const y=a({props:{repo:{type:String,required:!0},repoId:{type:String,required:!0},category:String,categoryId:String,mapping:{type:String,required:!0},term:String,lang:{type:String,default:"en"},theme:{type:String,default:"light"},reactionsEnabled:{type:String,default:"1"},emitMetadata:{type:String,default:"0"},inputPosition:{type:String,default:"bottom"}},setup(e){const a=c(""),y=l((()=>{return function({repo:e,repoId:t,category:s="",categoryId:r="",mapping:n,term:i="",theme:o="light",reactionsEnabled:a="1",emitMetadata:c="0",inputPosition:l="bottom",lang:u="en",session:g,origin:m}){const d=new URL(location.href);d.searchParams.delete("giscus");const p=d.toString(),h={origin:m=m||p,session:g,theme:o,reactionsEnabled:a,emitMetadata:c,inputPosition:l,repo:e,repoId:t,category:s,categoryId:r,description:f("description")};switch(n){case"url":h.term=p;break;case"title":h.term=document.title;break;case"og:title":h.term=f("title");break;case"specific":h.term=i;break;case"number":h.number=i;break;case"pathname":default:h.term=location.pathname.length<2?"index":location.pathname.substring(1).replace(/\.\w+$/,"")}return`https://giscus.app/${u}/widget?${new URLSearchParams(h)}`}((c=((e,t)=>{for(var s in t||(t={}))n.call(t,s)&&o(e,s,t[s]);if(r)for(var s of r(t))i.call(t,s)&&o(e,s,t[s]);return e})({},e),l={session:a.value},t(c,s(l))));var c,l}));u((()=>{const e=location.href,t=new URL(e),s=localStorage.getItem("giscus-session");if(a.value=t.searchParams.get("giscus")||"",a.value)localStorage.setItem("giscus-session",JSON.stringify(a.value)),t.searchParams.delete("giscus"),history.replaceState(void 0,document.title,t.toString());else if(s)try{a.value=JSON.parse(s||"")||""}catch(r){a.value="",localStorage.removeItem("giscus-session"),console.warn(`${p(null==r?void 0:r.message)} Session has been cleared.`)}})),u(h);const b=c();return u((()=>{const e=function(e,t=null){return function(s){if("https://giscus.app"!==s.origin)return;const{data:r}=s;if("object"!=typeof r||!r.giscus)return;if(t&&r.giscus.resizeHeight&&(t.style.height=`${r.giscus.resizeHeight}px`),!r.giscus.error)return;const n=r.giscus.error;if(n.includes("Bad credentials")||n.includes("Invalid state value")){if(null!==localStorage.getItem("giscus-session"))return localStorage.removeItem("giscus-session"),e(),void console.warn(`${p(n)} Session has been cleared.`);console.error(`${p(n)} No session is stored initially. ${d}`)}n.includes("Discussion not found")?console.warn(`[giscus] ${n}. A new discussion will be created if a comment/reaction is submitted.`):console.error(`${p(n)} ${d}`)}}((()=>a.value=""),b.value);window.addEventListener("message",e),g((()=>window.removeEventListener("message",e)))})),()=>m("div",{className:"giscus"},[m("iframe",{className:"giscus-frame",title:"Comments",scrolling:"no",src:y.value,ref:b},null)])}}),b={install:e=>e.component("Giscus",y)};export{y as Giscus,b as plugin};
