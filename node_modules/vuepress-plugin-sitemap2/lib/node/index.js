"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("sitemap");const a=[],n=e=>({defaultPath:e.path.replace(e.pathLocale,"/"),pathLocale:e.pathLocale}),s=async(s,r)=>{const{excludeUrls:i=[],extraUrls:o=[],xmlNameSpace:p}=r,l=r.hostname.replace(/\/$/u,""),c=r.sitemapFilename?r.sitemapFilename.replace(/^\//u,""):"sitemap.xml",{dir:u,options:{base:m}}=s;await e.withSpinner(`Generating sitemap to ${e.chalk.cyan(c)}`)((()=>new Promise((d=>{const h=new t.SitemapStream({hostname:l,xmlns:p}),g=((t,s)=>{const{changefreq:r="daily",excludeUrls:i=["/404.html"],modifyTimeGetter:o=(e=>{var t;return(null===(t=e.data.git)||void 0===t?void 0:t.updatedTime)?new Date(e.data.git.updatedTime).toISOString():""})}=s,{pages:p,options:{base:l,locales:c}}=t,u=p.reduce(((e,t)=>{const{defaultPath:a,pathLocale:s}=n(t),r=e.get(a)||[];return r.push(s),e.set(a,r)}),new Map),m=new Map;return p.forEach((s=>{const p=s.frontmatter.sitemap||{},d=(s.frontmatter.head||[]).find((e=>"robots"===e[1].name));(d?(d[1].content||"").split(/,/u).map((e=>e.trim())).includes("noindex"):p.exclude)&&i.push(s.path);const h=o(s),{defaultPath:g}=n(s),f=u.get(g)||[];let $=[];f.length>1&&(t.env.isDebug&&f.forEach((t=>{c[t].lang||a.includes(t)||(e.logger.warn(`[sitemap2] 'lang' option for ${t} is missing`),a.push(t))})),$=f.map((e=>({lang:c[e].lang||"en",url:`${l.replace(/\/$/,"")}${g.replace(/^\//u,e)}`}))));const w={changefreq:r,links:$,...h?{lastmod:h}:{},...p};t.env.isDebug&&e.logger.info(`[sitemap2] sitemap option for ${s.path}`,w),m.set(s.path,w)})),s.excludeUrls=i,m})(s,r),f=u.dest(c),$=e.fs.createWriteStream(f);h.pipe($),g.forEach(((e,t)=>{i.includes(t)||h.write({url:`${m}${t.replace(/^\//u,"")}`,...e})})),o.forEach((e=>h.write({url:`${m}${e.replace(/^\//u,"")}`}))),h.end((()=>{d()}))}))));const d=u.dest("robots.txt");e.fs.existsSync(d)&&await e.withSpinner(`Appended sitemap path to ${e.chalk.cyan("robots.txt")}`)((async()=>{const t=`${(await e.fs.readFile(d,{encoding:"utf8"})).replace(/^Sitemap: .*$/u,"")}\nSitemap: ${l}${m}${c}\n`;await e.fs.writeFile(d,t,{flag:"w"})}))},r=t=>{const a={name:"vuepress-plugin-sitemap2"};return t.hostname?{...a,onGenerated:e=>s(e,t)}:(e.logger.warn(`[${a.name}] 'hostname' is required`),a)};exports.default=r,exports.sitemap=e=>["sitemap2",e],exports.sitemapPlugin=r;
//# sourceMappingURL=index.js.map
