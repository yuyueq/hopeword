import{IconBase as e,useLocaleConfig as t}from"@mr-hope/vuepress-shared/lib/client";import{h as l,defineComponent as n,ref as a,onMounted as o,onBeforeMount as s,resolveComponent as i,openBlock as c,createElementBlock as r,createElementVNode as u,createVNode as m,createCommentVNode as d,toDisplayString as v,Fragment as p,renderList as h,createTextVNode as f,computed as g}from"vue";import{withBase as w}from"@vuepress/client";import"../styles/modal.scss";const y=()=>l(e,{name:"arrow-left"},(()=>l("path",{d:"M802.8 448h-428l166-158.8c23.8-25 23.8-65.4 0-90.4s-62.4-25-86.4 0L178 466.8c-12 11.6-18 27.4-18 44.8v0.8c0 17.4 6 33.2 18 44.8l276.2 268c24 25 62.6 25 86.4 0 23.8-25 23.8-65.4 0-90.4l-166-158.8h428c33.8 0 61.2-28.6 61.2-64 0.2-36-27.2-64-61-64z"})));y.displayName="ArrowLeftIcon";const b=()=>l(e,{name:"arrow-right"},(()=>l("path",{d:"M569.8 825.2l276.2-268c12-11.6 18-27.4 18-44.8v-0.8c0-17.4-6-33.2-18-44.8l-276.2-268c-24-25-62.6-25-86.4 0-23.8 25-23.8 65.4 0 90.4l166 158.8h-428c-34 0-61.4 28.6-61.4 64 0 36 27.4 64 61.2 64h428l-166 158.8c-23.8 25-23.8 65.4 0 90.4 24 25 62.6 25 86.6 0z"})));b.displayName="ArrowRightIcon";const I=()=>l(e,{name:"close"},(()=>l("path",{d:"M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"})));I.displayName="CloseIcon";const k=PWA_LOCALES;let C,A;var L=n({name:"PWAInstallModal",components:{ArrowLeftIcon:y,ArrowRightIcon:b,CloseIcon:I},props:{useHint:{type:Boolean,default:!1}},emits:["can-install","hint","toggle"],setup(e,{emit:l}){const n=t(k),i=a({}),c=a(!1),r=a(null),u=async()=>{const e=localStorage.getItem("manifest");if(e)i.value=JSON.parse(e);else try{const e=await fetch(w("manifest.webmanifest")),t=await e.json();i.value=t,localStorage.setItem("manifest",JSON.stringify(t))}catch(e){console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}};return o((()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(A=e=>{r.value=e,l("can-install",!0),e.preventDefault()},window.addEventListener("beforeinstallprompt",A),u(),C=e=>{"Escape"===e.key&&l("toggle",!1)},document.addEventListener("keyup",C))})),s((()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&document.removeEventListener("beforeinstallprompt",A),document.removeEventListener("keyup",C)})),{locale:n,isIOS:c,manifest:i,getManifest:u,scrolltoLeft:()=>{const e=document.querySelector(".screenshot");e&&e.scrollBy({left:-e.clientWidth,top:0,behavior:"smooth"})},scrolltoRight:()=>{const e=document.querySelector(".screenshot");e&&e.scrollBy({left:e.clientWidth,top:0,behavior:"smooth"})},install:async()=>{if(r.value){r.value.prompt(),document.dispatchEvent(new CustomEvent("show"));"accepted"===(await r.value.userChoice).outcome?(console.info("PWA has been installed"),l("toggle",!1),l("can-install",!1)):(console.info("You choose to not install PWA"),l("toggle",!1),l("can-install",!1))}},hint:()=>{console.info("You accepted the install hint"),l("hint")}}}});const P={id:"install-modal-wrapper"},S={class:"install-modal"},x={class:"header"},E=["aria-label"],O={class:"logo"},W=["src"],M={class:"title"},R={class:"desc"},B={class:"content"},N={class:"highlight"},_={key:0,class:"feature-wrapper"},H={key:0},z=["textContent"],T={key:1,class:"screenshot-wrapper"},$=["aria-label"],q={class:"screenshot"},J=["src"],Y=["aria-label"],j={class:"description"},D=["textContent"],G=["textContent"],F=u("button",{class:"success"},"Got it!",-1),K={key:1,class:"button-wrapper"};L.render=function(e,t,l,n,a,o){const s=i("CloseIcon"),g=i("ArrowLeftIcon"),w=i("ArrowRightIcon");return c(),r("div",P,[u("div",{class:"background",onClick:t[0]||(t[0]=t=>e.$emit("toggle",!1))}),u("div",S,[u("div",x,[u("button",{class:"close-button","aria-label":e.locale.close,onClick:t[1]||(t[1]=t=>e.$emit("toggle",!1))},[m(s)],8,E),u("div",O,[e.manifest.icons?(c(),r("img",{key:0,src:e.manifest.icons[0].src,alt:"App Logo"},null,8,W)):d("v-if",!0),u("div",M,[u("h1",null,v(e.manifest.short_name||e.manifest.name),1),u("p",R,v(e.locale.explain),1)])])]),u("div",B,[u("div",N,[e.manifest.features?(c(),r("div",_,[u("h3",null,v(e.locale.feature),1),e.manifest.features?(c(),r("ul",H,[(c(!0),r(p,null,h(e.manifest.features,(e=>(c(),r("li",{key:e,textContent:v(e)},null,8,z)))),128))])):d("v-if",!0)])):d("v-if",!0),e.manifest.screenshots?(c(),r("div",T,[u("button",{"aria-label":e.locale.prevImage,onClick:t[2]||(t[2]=(...t)=>e.scrolltoLeft&&e.scrolltoLeft(...t))},[m(g)],8,$),u("section",q,[(c(!0),r(p,null,h(e.manifest.screenshots,(e=>(c(),r("div",{key:e.src},[u("img",{alt:"App Screenshot",src:e.src},null,8,J)])))),128))]),u("button",{"aria-label":e.locale.nextImage,onClick:t[3]||(t[3]=(...t)=>e.scrolltoRight&&e.scrolltoRight(...t))},[m(w)],8,Y)])):d("v-if",!0)]),u("div",j,[u("h3",{textContent:v(e.locale.desc)},null,8,D),u("p",{textContent:v(e.manifest.description)},null,8,G)])]),e.useHint?(c(),r("div",{key:0,class:"ios-text",onClick:t[4]||(t[4]=(...t)=>e.hint&&e.hint(...t))},[u("p",null,v(e.locale.iOSInstall),1),F])):(c(),r("div",K,[u("button",{class:"install-button",onClick:t[5]||(t[5]=(...t)=>e.install&&e.install(...t))},[f(v(e.locale.install)+" ",1),u("span",null,v(e.manifest.short_name),1)]),u("button",{class:"cancel-button",onClick:t[6]||(t[6]=t=>e.$emit("toggle",!1))},v(e.locale.cancel),1)]))])])},L.__file="src/client/components/PWAInstallModal.vue";var Q=n({name:"PWAInstall",setup(){const e=t(k),n=a(!1),s=a(!1),i=a(!1),c=a(!1),r=a(!1),u=a(!1),m=g((()=>c.value&&r.value&&!1===u.value)),d=g((()=>s.value&&n.value||m.value));return o((()=>{if(navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches){const{userAgent:e}=navigator;c.value=e.includes("iPhone")||e.includes("iPad")||Boolean(e.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),r.value=navigator.userAgent.includes("Safari")&&!e.includes("Chrome"),u.value=Boolean(localStorage.getItem("iOS-pwa-hint"))}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then((e=>{s.value=e.length>0}))})),()=>l("div",{id:"pwa-install"},[d.value?l("button",{class:"modal-button",useHint:m.value,onClick:()=>{i.value=!0}},e.value.install):null,l(L,{style:{display:i.value?"block":"none"},onCanInstall:e=>{n.value=e},onHint:()=>(i.value=!1,u.value=!0,void localStorage.setItem("iOS-pwa-hint","hinted")),onToggle:e=>{i.value=e}})])}});export{Q as default};
//# sourceMappingURL=PWAInstall.js.map
