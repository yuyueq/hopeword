"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@mr-hope/vuepress-shared"),t=require("@vuepress/utils");const a=new e.Logger("vuepress-plugin-seo2"),r=(e,t,a)=>`${e.match(/https?:\/\//)?"":"https://"}${e.replace(/\/$/u,"")}${t}${a.replace(/^\//u,"")}`,o=(t,a,o)=>{var s;const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{base:i}=o.options,{frontmatter:{author:l,time:c,date:g=c,tag:p,tags:m=p},git:u={}}=t,{siteData:d}=o,f=d.locales[t.pathLocale].title||d.title||d.locales["/"].title||"",h=!1===l?[]:e.getAuthor(l||a.author),{updatedTime:$}=u,b=$?new Date($).toISOString():"",v=Array.isArray(m)?m:"string"==typeof p?[p]:[],w=t.title,y=((t,a,o)=>{const{banner:s,cover:n}=t.frontmatter;if(s){if(e.isAbsoluteUrl(s))return r(a.hostname,o.options.base,s);if(e.isUrl(s))return s}if(n){if(e.isAbsoluteUrl(n))return r(a.hostname,o.options.base,n);if(e.isUrl(n))return n}return null})(t,a,o),x=((t,a,o)=>{const s=/!\[.*?\]\((.*?)\)/giu.exec(t.content);return s?s.map((([,t])=>e.isAbsoluteUrl(t)?r(a.hostname,o.options.base,t):e.isUrl(t)?t:null)).filter((e=>null!==e)):[]})(t,a,o),D=((e,t)=>Object.entries(t).map((([,e])=>e.lang)).filter((t=>"string"==typeof t&&t!==e)))(t.lang,d.locales);let O="";if(g instanceof Date)O=new Date(g).toISOString();else if(g){const t=e.getDate(g);t&&t.value&&(O=t.value.toISOString())}const S=y||x[0]||a.fallBackImage||"";return{OGP:{"og:url":r(a.hostname,i,t.path),"og:site_name":f,"og:title":w,"og:description":t.frontmatter.description||a.autoDescription&&t.frontmatter.summary||"","og:type":n(t)?"article":"website","og:image":S,"og:updated_time":b,"og:locale":t.lang,"og:locale:alternate":D,...S?{"twitter:card":"summary_large_image","twitter:image:alt":w}:{},"article:author":null===(s=h[0])||void 0===s?void 0:s.name,"article:tag":v,"article:published_time":O,"article:modified_time":b},JSONLD:n(t)?{"@context":"https://schema.org","@type":"NewsArticle",headline:w,image:x.length?x:[y||a.fallBackImage||""],datePublished:O,dateModified:b,author:h.map((e=>({"@type":"Person",...e})))}:null}},s=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},n=r=>r.hostname?{name:"vuepress-plugin-seo2",extendsPage:(t,a)=>{var n;t.frontmatter.description||(t.frontmatter.summary=e.stripTags(t.excerpt)||(n=t.content,n?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(n).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||"");const i=t.frontmatter.head||[],{OGP:l,JSONLD:c}=o(t,r,a),g=r.ogp?r.ogp(l,t,a):l,p=r.jsonLd?r.jsonLd(c,t,a):null;((e,t,a)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>s(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&s(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&s(e,{name:a,content:t[a]})}a.restrictions&&s(e,{name:"og:restrictions:age",content:a.restrictions}),a.twitterID&&s(e,{name:"twitter:creator",content:a.twitterID})})(i,g,r),p&&i.push(["script",{type:"application/ld+json"},JSON.stringify(p)]),r.customHead&&r.customHead(i,t,a),t.frontmatter.head=i},onGenerated:e=>(async e=>{a.load("Generating robots.txt");const r=e.public("robots.txt");let o=t.fs.existsSync(r)?await t.fs.readFile(r,{encoding:"utf8"}):"";o&&!o.includes("User-agent")?(a.error(),a.update("robots.txt seems invalid!")):(o+="\nUser-agent:*\nDisallow:\n",await t.fs.writeFile(e.dest("robots.txt"),o,{flag:"w"}),a.succeed())})(e.dir)}:(a.error("Option 'hostname' is required!"),{name:"vuepress-plugin-seo2"});exports.default=n,exports.seo=e=>["seo2",e],exports.seoPlugin=n;
//# sourceMappingURL=index.js.map
